<!DOCTYPE html>
<html>
<head><title>Test Share Verse</title></head>
<body>
  <h2>ðŸ“– Verse Preview & Share Test</h2>
  <p data-verse id="test1">In the beginning Elohim created the heavens and the earth.</p>
  <button onclick="previewVerseImage(); shareVerse()">ðŸ“¤ Share</button>
  <div id="previewContainer"></div>

  <script>
    function getSelectedVerses() {
      return document.getElementById("test1").textContent;
    }

    async function createVerseImage(text) {
      return new Promise(resolve => {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 1080; canvas.height = 720;
        ctx.fillStyle = '#fff'; ctx.fillRect(0, 0, 1080, 720);
        ctx.fillStyle = '#000'; ctx.font = '32px Arial'; ctx.textAlign = 'center';
        ctx.fillText(text, 540, 360);
        canvas.toBlob(blob => {
          const file = new File([blob], 'verse.png', { type: 'image/png' });
          resolve(file);
        });
      });
    }

    async function previewVerseImage() {
      const text = getSelectedVerses();
      const file = await createVerseImage(text);
      const url = URL.createObjectURL(file);
      const img = document.createElement('img');
      img.src = url;
      img.style.width = '90%';
      img.style.maxWidth = '500px';
      document.getElementById('previewContainer').innerHTML = '';
      document.getElementById('previewContainer').appendChild(img);
    }

    async function shareVerse() {
      const text = getSelectedVerses();
      const file = await createVerseImage(text);
      if (navigator.canShare && navigator.canShare({ files: [file] })) {
        await navigator.share({
          title: "Boek van Herinnering",
          text: text,
          files: [file]
        });
      } else {
        navigator.clipboard.writeText(text);
        alert("Sharing not supported. Text copied.");
      }
    }
  </script>
</body>
</html>
